{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"ChatGPT Prompt Filler","options":{"check_for_updates":true,"user_modified":1769463528594,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"run_in":null,"tags":[],"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":[],"orig_matches":["https://chatgpt.com/*","https://chat.openai.com/*"],"orig_noframes":null,"orig_run_at":"document-idle","orig_run_in":[],"orig_tags":[],"use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]}},"storage":{"ts":1769463984026,"data":{"pf_library_v1":"s{\"categories\":[{\"id\":\"cat_work\",\"name\":\"Work / InfoSec\"},{\"id\":\"cat_science\",\"name\":\"Philosophy / Science\"},{\"id\":\"cat_scratch\",\"name\":\"Scratch\"}],\"prompts\":[{\"id\":\"p_risk_summary\",\"categoryId\":\"cat_work\",\"title\":\"Risk summary (1 page)\",\"body\":\"Write a 1-page risk summary.\\n\\nContext:\\n- System/Process:\\n- Data types:\\n- Threats:\\n- Controls:\\n- Residual risk:\\n- Recommended next steps:\\n\\nConstraints:\\n- Be precise and non-alarmist.\\n- Include assumptions explicitly.\"},{\"id\":\"p_policy_rewrite\",\"categoryId\":\"cat_work\",\"title\":\"Policy clause rewrite\",\"body\":\"Rewrite the following policy clause for clarity, enforceability, and least-privilege alignment.\\n\\nClause:\\n<PASTE HERE>\\n\\nRequirements:\\n- Keep intent the same unless you flag changes.\\n- Provide: (1) clean rewrite (2) annotated rationale (3) options if tradeoffs exist.\"},{\"id\":\"p_b30d99a9fd4f4_19bfc32d730\",\"categoryId\":\"cat_science\",\"title\":\"Epistemic Charter\",\"body\":\"## Epistemic Charter\\n\\n* **This conversation prioritizes understanding over conclusions.**\\n* Claims are treated as provisional, and confidence is proportional to justification.\\n* Assumptions should be surfaced explicitly when they matter, not smuggled implicitly for convenience.\\n* Disagreement is a signal to examine premises, not to defend positions.\\n* Compression, summary, or closure should occur only when it serves understanding, not momentum.\\n* When uncertainty is irreducible, name it rather than resolving it.\\n* If you reach a conclusion, name one way your own criterion could fail or be gamed.\\n* *The goal is not agreement on answers, but alignment on what it means to know.*\"},{\"id\":\"p_blank_scaffold\",\"categoryId\":\"cat_scratch\",\"title\":\"Blank scaffold\",\"body\":\"Context:\\n\\nGoal:\\n\\nConstraints:\\n\\nWhat I tried:\\n\\nQuestion:\"},{\"id\":\"p_first_principles\",\"categoryId\":\"cat_science\",\"title\":\"First-principles explanation\",\"body\":\"Explain this from first principles.\\n\\nTopic:\\n<PASTE HERE>\\n\\nConstraints:\\n- Define terms on first use.\\n- Make assumptions explicit.\\n- Use one or two logical steps at a time, and pause at natural checkpoints.\"}]}","pf_autosend_v1":"btrue"}},"enabled":true,"position":1,"uuid":"ffa481cb-057c-4ea7-b1ba-d8ebb734f04c","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBDaGF0R1BUIFByb21wdCBGaWxsZXIKLy8gQG5hbWVzcGFjZSAgICBsb2NhbC5lcmljLnByb21wdGZpbGxlcgovLyBAdmVyc2lvbiAgICAgIDAuNC4wCi8vIEBkZXNjcmlwdGlvbiAgTG9jYWwgcHJvbXB0IGxpYnJhcnkgZm9yIENoYXRHUFQ6IGNhdGVnb3JpZXMgKyBhZGQvZWRpdC9kZWxldGUgKyBpbXBvcnQvZXhwb3J0IEpTT04gKyBpbnNlcnQgaW50byBjb21wb3Nlci4KLy8gQG1hdGNoICAgICAgICBodHRwczovL2NoYXRncHQuY29tLyoKLy8gQG1hdGNoICAgICAgICBodHRwczovL2NoYXQub3BlbmFpLmNvbS8qCi8vIEBncmFudCAgICAgICAgR01fYWRkU3R5bGUKLy8gQGdyYW50ICAgICAgICBHTV9zZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgIEdNX2dldFZhbHVlCi8vID09L1VzZXJTY3JpcHQ9PQoKKCgpID0+IHsKICAndXNlIHN0cmljdCc7CgogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLy8gU2FtcGxlIGxpYnJhcnkgKG9wdGlvbmFsKQogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgY29uc3QgU0FNUExFX0xJQlJBUlkgPSB7CiAgICBjYXRlZ29yaWVzOiBbCiAgICAgIHsgaWQ6ICdjYXRfd29yaycsIG5hbWU6ICdXb3JrIC8gSW5mb1NlYycgfSwKICAgICAgeyBpZDogJ2NhdF9zY2llbmNlJywgbmFtZTogJ1BoaWxvc29waHkgLyBTY2llbmNlJyB9LAogICAgICB7IGlkOiAnY2F0X3NjcmF0Y2gnLCBuYW1lOiAnU2NyYXRjaCcgfSwKICAgIF0sCiAgICBwcm9tcHRzOiBbCiAgICAgIHsKICAgICAgICBpZDogJ3Bfcmlza19zdW1tYXJ5JywKICAgICAgICBjYXRlZ29yeUlkOiAnY2F0X3dvcmsnLAogICAgICAgIHRpdGxlOiAnUmlzayBzdW1tYXJ5ICgxIHBhZ2UpJywKICAgICAgICBib2R5OgpgV3JpdGUgYSAxLXBhZ2UgcmlzayBzdW1tYXJ5LgoKQ29udGV4dDoKLSBTeXN0ZW0vUHJvY2VzczoKLSBEYXRhIHR5cGVzOgotIFRocmVhdHM6Ci0gQ29udHJvbHM6Ci0gUmVzaWR1YWwgcmlzazoKLSBSZWNvbW1lbmRlZCBuZXh0IHN0ZXBzOgoKQ29uc3RyYWludHM6Ci0gQmUgcHJlY2lzZSBhbmQgbm9uLWFsYXJtaXN0LgotIEluY2x1ZGUgYXNzdW1wdGlvbnMgZXhwbGljaXRseS5gCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBpZDogJ3BfcG9saWN5X3Jld3JpdGUnLAogICAgICAgIGNhdGVnb3J5SWQ6ICdjYXRfd29yaycsCiAgICAgICAgdGl0bGU6ICdQb2xpY3kgY2xhdXNlIHJld3JpdGUnLAogICAgICAgIGJvZHk6CmBSZXdyaXRlIHRoZSBmb2xsb3dpbmcgcG9saWN5IGNsYXVzZSBmb3IgY2xhcml0eSwgZW5mb3JjZWFiaWxpdHksIGFuZCBsZWFzdC1wcml2aWxlZ2UgYWxpZ25tZW50LgoKQ2xhdXNlOgo8UEFTVEUgSEVSRT4KClJlcXVpcmVtZW50czoKLSBLZWVwIGludGVudCB0aGUgc2FtZSB1bmxlc3MgeW91IGZsYWcgY2hhbmdlcy4KLSBQcm92aWRlOiAoMSkgY2xlYW4gcmV3cml0ZSAoMikgYW5ub3RhdGVkIHJhdGlvbmFsZSAoMykgb3B0aW9ucyBpZiB0cmFkZW9mZnMgZXhpc3QuYAogICAgICB9LAogICAgICB7CiAgICAgICAgaWQ6ICdwX2ZpcnN0X3ByaW5jaXBsZXMnLAogICAgICAgIGNhdGVnb3J5SWQ6ICdjYXRfc2NpZW5jZScsCiAgICAgICAgdGl0bGU6ICdGaXJzdC1wcmluY2lwbGVzIGV4cGxhbmF0aW9uJywKICAgICAgICBib2R5OgpgRXhwbGFpbiB0aGlzIGZyb20gZmlyc3QgcHJpbmNpcGxlcy4KClRvcGljOgo8UEFTVEUgSEVSRT4KCkNvbnN0cmFpbnRzOgotIERlZmluZSB0ZXJtcyBvbiBmaXJzdCB1c2UuCi0gTWFrZSBhc3N1bXB0aW9ucyBleHBsaWNpdC4KLSBVc2Ugb25lIG9yIHR3byBsb2dpY2FsIHN0ZXBzIGF0IGEgdGltZSwgYW5kIHBhdXNlIGF0IG5hdHVyYWwgY2hlY2twb2ludHMuYAogICAgICB9LAogICAgICB7CiAgICAgICAgaWQ6ICdwX2JsYW5rX3NjYWZmb2xkJywKICAgICAgICBjYXRlZ29yeUlkOiAnY2F0X3NjcmF0Y2gnLAogICAgICAgIHRpdGxlOiAnQmxhbmsgc2NhZmZvbGQnLAogICAgICAgIGJvZHk6IGBDb250ZXh0OlxuXG5Hb2FsOlxuXG5Db25zdHJhaW50czpcblxuV2hhdCBJIHRyaWVkOlxuXG5RdWVzdGlvbjpgCiAgICAgIH0KICAgIF0KICB9OwoKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIC8vIFN0b3JhZ2Uga2V5cwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgY29uc3QgS0VZX0RBVEEgPSAncGZfbGlicmFyeV92MSc7CiAgY29uc3QgS0VZX0FVVE9TRU5EID0gJ3BmX2F1dG9zZW5kX3YxJzsKICBjb25zdCBLRVlfQkFDS1VQX0xBU1QgPSAncGZfbGlicmFyeV9iYWNrdXBfbGFzdCc7CgogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLy8gSGVscGVycwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgY29uc3Qgc2xlZXAgPSAobXMpID0+IG5ldyBQcm9taXNlKHIgPT4gc2V0VGltZW91dChyLCBtcykpOwoKICBmdW5jdGlvbiB1aWQocHJlZml4ID0gJ2lkJykgewogICAgcmV0dXJuIGAke3ByZWZpeH1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KS5zbGljZSgyKX1fJHtEYXRlLm5vdygpLnRvU3RyaW5nKDE2KX1gOwogIH0KCiAgZnVuY3Rpb24gc2FmZUpzb25QYXJzZShzLCBmYWxsYmFjaykgewogICAgdHJ5IHsgcmV0dXJuIEpTT04ucGFyc2Uocyk7IH0gY2F0Y2ggeyByZXR1cm4gZmFsbGJhY2s7IH0KICB9CgogIGZ1bmN0aW9uIGVzY0h0bWwocykgewogICAgcmV0dXJuIFN0cmluZyhzKS5yZXBsYWNlKC9bJjw+IiddL2csIChjKSA9PiAoewogICAgICAnJic6ICcmYW1wOycsICc8JzogJyZsdDsnLCAnPic6ICcmZ3Q7JywgJyInOiAnJnF1b3Q7JywgIiciOiAnJiMwMzk7JwogICAgfVtjXSkpOwogIH0KCiAgZnVuY3Rpb24gaXNWaXNpYmxlKGVsKSB7CiAgICBjb25zdCByID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICByZXR1cm4gci53aWR0aCA+IDAgJiYgci5oZWlnaHQgPiAwOwogIH0KCiAgZnVuY3Rpb24gZmluZENvbXBvc2VyRWxlbWVudCgpIHsKICAgIGNvbnN0IGNhbmRpZGF0ZXMgPSBbCiAgICAgICd0ZXh0YXJlYScsCiAgICAgICdkaXZbY29udGVudGVkaXRhYmxlPSJ0cnVlIl0nLAogICAgICAnW3JvbGU9InRleHRib3giXVtjb250ZW50ZWRpdGFibGU9InRydWUiXScsCiAgICAgICdbcm9sZT0idGV4dGJveCJdJwogICAgXTsKICAgIGZvciAoY29uc3Qgc2VsIG9mIGNhbmRpZGF0ZXMpIHsKICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbCk7CiAgICAgIGlmIChlbCAmJiBpc1Zpc2libGUoZWwpKSByZXR1cm4gZWw7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CgogIGZ1bmN0aW9uIHNldENvbXBvc2VyVGV4dChlbCwgdGV4dCkgewogICAgaWYgKGVsLnRhZ05hbWUgPT09ICdURVhUQVJFQScgfHwgZWwudGFnTmFtZSA9PT0gJ0lOUFVUJykgewogICAgICBlbC5mb2N1cygpOwogICAgICBlbC52YWx1ZSA9IHRleHQ7CiAgICAgIGVsLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdpbnB1dCcsIHsgYnViYmxlczogdHJ1ZSB9KSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGVsLmZvY3VzKCk7CiAgICB0cnkgewogICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnc2VsZWN0QWxsJywgZmFsc2UsIG51bGwpOwogICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0VGV4dCcsIGZhbHNlLCB0ZXh0KTsKICAgIH0gY2F0Y2ggewogICAgICBlbC50ZXh0Q29udGVudCA9IHRleHQ7CiAgICB9CiAgICBlbC5kaXNwYXRjaEV2ZW50KG5ldyBJbnB1dEV2ZW50KCdpbnB1dCcsIHsgYnViYmxlczogdHJ1ZSwgaW5wdXRUeXBlOiAnaW5zZXJ0VGV4dCcsIGRhdGE6IHRleHQgfSkpOwogIH0KCiAgZnVuY3Rpb24gZ2V0QXV0b1NlbmQoKSB7CiAgICB0cnkgeyByZXR1cm4gISFHTV9nZXRWYWx1ZShLRVlfQVVUT1NFTkQsIGZhbHNlKTsgfSBjYXRjaCB7IHJldHVybiBmYWxzZTsgfQogIH0KICBmdW5jdGlvbiBzZXRBdXRvU2VuZCh2KSB7CiAgICB0cnkgeyBHTV9zZXRWYWx1ZShLRVlfQVVUT1NFTkQsICEhdik7IH0gY2F0Y2ggeyAvKiBpZ25vcmUgKi8gfQogIH0KCiAgYXN5bmMgZnVuY3Rpb24gY2xpY2tTZW5kSWZFbmFibGVkKCkgewogICAgaWYgKCFnZXRBdXRvU2VuZCgpKSByZXR1cm47CgogICAgY29uc3QgYnRuU2VsZWN0b3JzID0gWwogICAgICAnYnV0dG9uW2RhdGEtdGVzdGlkPSJzZW5kLWJ1dHRvbiJdJywKICAgICAgJ2J1dHRvblthcmlhLWxhYmVsPSJTZW5kIG1lc3NhZ2UiXScsCiAgICAgICdidXR0b25bdHlwZT0ic3VibWl0Il0nCiAgICBdOwoKICAgIGZvciAoY29uc3Qgc2VsIG9mIGJ0blNlbGVjdG9ycykgewogICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbCk7CiAgICAgIGlmIChidG4gJiYgaXNWaXNpYmxlKGJ0bikgJiYgIWJ0bi5kaXNhYmxlZCkgewogICAgICAgIGJ0bi5jbGljaygpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gZG93bmxvYWRUZXh0RmlsZShmaWxlbmFtZSwgdGV4dCkgewogICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFt0ZXh0XSwgeyB0eXBlOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04JyB9KTsKICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgYS5ocmVmID0gdXJsOwogICAgYS5kb3dubG9hZCA9IGZpbGVuYW1lOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgIGEuY2xpY2soKTsKICAgIGEucmVtb3ZlKCk7CiAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7CiAgfQoKICBmdW5jdGlvbiB2YWxpZGF0ZUxpYnJhcnlTaGFwZShvYmopIHsKICAgIGlmICghb2JqIHx8IHR5cGVvZiBvYmogIT09ICdvYmplY3QnKSByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiAnUm9vdCBtdXN0IGJlIGFuIG9iamVjdC4nIH07CiAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqLmNhdGVnb3JpZXMpKSByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiAnTWlzc2luZyAiY2F0ZWdvcmllcyIgYXJyYXkuJyB9OwogICAgaWYgKCFBcnJheS5pc0FycmF5KG9iai5wcm9tcHRzKSkgcmV0dXJuIHsgb2s6IGZhbHNlLCBlcnJvcjogJ01pc3NpbmcgInByb21wdHMiIGFycmF5LicgfTsKCiAgICBmb3IgKGNvbnN0IGMgb2Ygb2JqLmNhdGVnb3JpZXMpIHsKICAgICAgaWYgKCFjIHx8IHR5cGVvZiBjICE9PSAnb2JqZWN0JykgcmV0dXJuIHsgb2s6IGZhbHNlLCBlcnJvcjogJ0NhdGVnb3J5IGVudHJpZXMgbXVzdCBiZSBvYmplY3RzLicgfTsKICAgICAgaWYgKHR5cGVvZiBjLmlkICE9PSAnc3RyaW5nJyB8fCAhYy5pZC50cmltKCkpIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6ICdFYWNoIGNhdGVnb3J5IG11c3QgaGF2ZSBhIG5vbi1lbXB0eSBzdHJpbmcgaWQuJyB9OwogICAgICBpZiAodHlwZW9mIGMubmFtZSAhPT0gJ3N0cmluZycgfHwgIWMubmFtZS50cmltKCkpIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6ICdFYWNoIGNhdGVnb3J5IG11c3QgaGF2ZSBhIG5vbi1lbXB0eSBzdHJpbmcgbmFtZS4nIH07CiAgICB9CgogICAgZm9yIChjb25zdCBwIG9mIG9iai5wcm9tcHRzKSB7CiAgICAgIGlmICghcCB8fCB0eXBlb2YgcCAhPT0gJ29iamVjdCcpIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6ICdQcm9tcHQgZW50cmllcyBtdXN0IGJlIG9iamVjdHMuJyB9OwogICAgICBpZiAodHlwZW9mIHAuaWQgIT09ICdzdHJpbmcnIHx8ICFwLmlkLnRyaW0oKSkgcmV0dXJuIHsgb2s6IGZhbHNlLCBlcnJvcjogJ0VhY2ggcHJvbXB0IG11c3QgaGF2ZSBhIG5vbi1lbXB0eSBzdHJpbmcgaWQuJyB9OwogICAgICBpZiAodHlwZW9mIHAuY2F0ZWdvcnlJZCAhPT0gJ3N0cmluZycgfHwgIXAuY2F0ZWdvcnlJZC50cmltKCkpIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6ICdFYWNoIHByb21wdCBtdXN0IGhhdmUgYSBub24tZW1wdHkgc3RyaW5nIGNhdGVnb3J5SWQuJyB9OwogICAgICBpZiAodHlwZW9mIHAudGl0bGUgIT09ICdzdHJpbmcnIHx8ICFwLnRpdGxlLnRyaW0oKSkgcmV0dXJuIHsgb2s6IGZhbHNlLCBlcnJvcjogJ0VhY2ggcHJvbXB0IG11c3QgaGF2ZSBhIG5vbi1lbXB0eSBzdHJpbmcgdGl0bGUuJyB9OwogICAgICBpZiAodHlwZW9mIHAuYm9keSAhPT0gJ3N0cmluZycpIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6ICdFYWNoIHByb21wdCBtdXN0IGhhdmUgYSBzdHJpbmcgYm9keS4nIH07CiAgICB9CgogICAgY29uc3QgY2F0SWRzID0gbmV3IFNldChvYmouY2F0ZWdvcmllcy5tYXAoYyA9PiBjLmlkKSk7CiAgICBmb3IgKGNvbnN0IHAgb2Ygb2JqLnByb21wdHMpIHsKICAgICAgaWYgKCFjYXRJZHMuaGFzKHAuY2F0ZWdvcnlJZCkpIHsKICAgICAgICByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiBgUHJvbXB0ICIke3AudGl0bGV9IiByZWZlcmVuY2VzIG1pc3NpbmcgY2F0ZWdvcnlJZCAiJHtwLmNhdGVnb3J5SWR9Ii5gIH07CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBkdXBDaGVjayA9IChhcnIsIGtleSkgPT4gewogICAgICBjb25zdCBzZWVuID0gbmV3IFNldCgpOwogICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgYXJyKSB7CiAgICAgICAgaWYgKHNlZW4uaGFzKGl0ZW1ba2V5XSkpIHJldHVybiBpdGVtW2tleV07CiAgICAgICAgc2Vlbi5hZGQoaXRlbVtrZXldKTsKICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH07CiAgICBjb25zdCBkdXBDYXQgPSBkdXBDaGVjayhvYmouY2F0ZWdvcmllcywgJ2lkJyk7CiAgICBpZiAoZHVwQ2F0KSByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiBgRHVwbGljYXRlIGNhdGVnb3J5IGlkOiAke2R1cENhdH1gIH07CiAgICBjb25zdCBkdXBQcm9tcHQgPSBkdXBDaGVjayhvYmoucHJvbXB0cywgJ2lkJyk7CiAgICBpZiAoZHVwUHJvbXB0KSByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiBgRHVwbGljYXRlIHByb21wdCBpZDogJHtkdXBQcm9tcHR9YCB9OwoKICAgIHJldHVybiB7IG9rOiB0cnVlIH07CiAgfQoKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIC8vIExpYnJhcnkgZGF0YSBtb2RlbAogIC8vIGRhdGEgPSB7IGNhdGVnb3JpZXM6IFt7aWQsbmFtZX1dLCBwcm9tcHRzOlt7aWQsY2F0ZWdvcnlJZCx0aXRsZSxib2R5fV0gfQogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgZnVuY3Rpb24gbG9hZExpYnJhcnkoKSB7CiAgICBjb25zdCByYXcgPSAoKCkgPT4geyB0cnkgeyByZXR1cm4gR01fZ2V0VmFsdWUoS0VZX0RBVEEsICcnKTsgfSBjYXRjaCB7IHJldHVybiAnJzsgfSB9KSgpOwogICAgY29uc3QgcGFyc2VkID0gc2FmZUpzb25QYXJzZShyYXcsIG51bGwpOwogICAgaWYgKHBhcnNlZCAmJiBBcnJheS5pc0FycmF5KHBhcnNlZC5jYXRlZ29yaWVzKSAmJiBBcnJheS5pc0FycmF5KHBhcnNlZC5wcm9tcHRzKSkgcmV0dXJuIHBhcnNlZDsKCiAgICAvLyBGaXJzdCBydW46IHNlZWQgd2l0aCBzYW1wbGUKICAgIGNvbnN0IHNlZWQgPSBzdHJ1Y3R1cmVkQ2xvbmUKICAgICAgPyBzdHJ1Y3R1cmVkQ2xvbmUoU0FNUExFX0xJQlJBUlkpCiAgICAgIDogc2FmZUpzb25QYXJzZShKU09OLnN0cmluZ2lmeShTQU1QTEVfTElCUkFSWSksIFNBTVBMRV9MSUJSQVJZKTsKICAgIHNhdmVMaWJyYXJ5KHNlZWQpOwogICAgcmV0dXJuIHNlZWQ7CiAgfQoKICBmdW5jdGlvbiBzYXZlTGlicmFyeShkYXRhKSB7CiAgICB0cnkgeyBHTV9zZXRWYWx1ZShLRVlfREFUQSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOyB9IGNhdGNoIHsgLyogaWdub3JlICovIH0KICB9CgogIGZ1bmN0aW9uIG5vcm1hbGl6ZUxpYnJhcnkoZGF0YSkgewogICAgY29uc3QgY2F0SWRzID0gbmV3IFNldChkYXRhLmNhdGVnb3JpZXMubWFwKGMgPT4gYy5pZCkpOwogICAgZGF0YS5wcm9tcHRzID0gZGF0YS5wcm9tcHRzLmZpbHRlcihwID0+IGNhdElkcy5oYXMocC5jYXRlZ29yeUlkKSk7CiAgfQoKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIC8vIERhcmstb25seSBDU1MKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIEdNX2FkZFN0eWxlKGAKICAgICNwZl9idG4gewogICAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICAgIHJpZ2h0OiAxOHB4OwogICAgICBib3R0b206IDE4cHg7CiAgICAgIHotaW5kZXg6IDk5OTk5OTsKICAgICAgcGFkZGluZzogNnB4IDhweDsKICAgICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjE0KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgzMiwgMzIsIDM2LCAwLjkyKTsKICAgICAgY29sb3I6ICNlNmU2ZWI7CiAgICAgIGZvbnQ6IDEycHgvMS4yIHN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSwgU2Vnb2UgVUksIFJvYm90bywgc2Fucy1zZXJpZjsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICBib3gtc2hhZG93OiAwIDRweCAxMnB4IHJnYmEoMCwwLDAsMC42KTsKICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgICB9CgogICAgI3BmX3BhbmVsIHsKICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICByaWdodDogMThweDsKICAgICAgYm90dG9tOiA2NHB4OwogICAgICB3aWR0aDogNDQwcHg7CiAgICAgIG1heC1oZWlnaHQ6IDcydmg7CiAgICAgIG92ZXJmbG93OiBhdXRvOwogICAgICB6LWluZGV4OiA5OTk5OTk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4xOCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjgsIDI4LCAzMiwgMC45Nik7CiAgICAgIGNvbG9yOiAjZTZlNmViOwogICAgICBib3gtc2hhZG93OiAwIDEycHggNDBweCByZ2JhKDAsMCwwLDAuNzUpOwogICAgICBwYWRkaW5nOiAxMnB4OwogICAgICBkaXNwbGF5OiBub25lOwogICAgICBmb250OiAxM3B4LzEuMzUgc3lzdGVtLXVpLCAtYXBwbGUtc3lzdGVtLCBTZWdvZSBVSSwgUm9ib3RvLCBzYW5zLXNlcmlmOwogICAgfQoKICAgICNwZl9wYW5lbCBoZWFkZXIgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBnYXA6IDEwcHg7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDsKICAgIH0KCiAgICAucGZfdGFicyB7IGRpc3BsYXk6ZmxleDsgZ2FwOjhweDsgfQogICAgLnBmX3RhYiB7CiAgICAgIHBhZGRpbmc6IDZweCAxMHB4OwogICAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMTQpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDM2LDM2LDQyLDAuOSk7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICB1c2VyLXNlbGVjdDogbm9uZTsKICAgIH0KICAgIC5wZl90YWIuYWN0aXZlIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LDAuMzIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDQ0LDQ0LDUyLDAuOTUpOwogICAgICBmb250LXdlaWdodDogNzAwOwogICAgfQoKICAgIC5wZl9yb3cgeyBkaXNwbGF5OmZsZXg7IGdhcDoxMHB4OyBhbGlnbi1pdGVtczpjZW50ZXI7IH0KICAgIC5wZl90b2dnbGUgeyBkaXNwbGF5OmZsZXg7IGdhcDo2cHg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZm9udC1zaXplOjEycHg7IG9wYWNpdHk6MC45NTsgd2hpdGUtc3BhY2U6IG5vd3JhcDsgfQogICAgLnBmX2J0bjIgewogICAgICBwYWRkaW5nOiA2cHggMTBweDsKICAgICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjE0KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgzNiwzNiw0MiwwLjkpOwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIGNvbG9yOiAjZTZlNmViOwogICAgICBmb250LXNpemU6IDEycHg7CiAgICAgIHVzZXItc2VsZWN0OiBub25lOwogICAgfQogICAgLnBmX2J0bjI6aG92ZXIgeyBib3JkZXItY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC4zMik7IGJhY2tncm91bmQ6IHJnYmEoNDQsNDQsNTIsMC45NSk7IH0KCiAgICAjcGZfcGFuZWwgaW5wdXRbdHlwZT0idGV4dCJdLCAjcGZfcGFuZWwgdGV4dGFyZWEsICNwZl9wYW5lbCBzZWxlY3QgewogICAgICB3aWR0aDogMTAwJTsKICAgICAgcGFkZGluZzogOHB4IDEwcHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMTgsIDE4LCAyMiwgMC45NSk7CiAgICAgIGNvbG9yOiAjZTZlNmViOwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMTgpOwogICAgICBvdXRsaW5lOiBub25lOwogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgfQogICAgI3BmX3BhbmVsIHRleHRhcmVhIHsgbWluLWhlaWdodDogMTIwcHg7IHJlc2l6ZTogdmVydGljYWw7IGZvbnQtZmFtaWx5OiB1aS1tb25vc3BhY2UsIFNGTW9uby1SZWd1bGFyLCBNZW5sbywgTW9uYWNvLCBDb25zb2xhcywgbW9ub3NwYWNlOyBmb250LXNpemU6IDEycHg7IH0KCiAgICAjcGZfcGFuZWwgaW5wdXQ6OnBsYWNlaG9sZGVyIHsgY29sb3I6IHJnYmEoMjMwLDIzMCwyMzUsMC40NSk7IH0KCiAgICAucGZfc2VjdGlvbiB7IG1hcmdpbi10b3A6IDEwcHg7IHBhZGRpbmctdG9wOiAxMHB4OyBib3JkZXItdG9wOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTsgfQogICAgLnBmX2dyb3VwIHsgbWFyZ2luOiAxMHB4IDAgNnB4OyBmb250LXdlaWdodDogODAwOyBmb250LXNpemU6IDEycHg7IGNvbG9yOiByZ2JhKDIzMCwyMzAsMjM1LDAuNjUpOyB9CiAgICAucGZfaXRlbSB7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4xNCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgIHBhZGRpbmc6IDEwcHg7CiAgICAgIG1hcmdpbjogOHB4IDA7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMzYsIDM2LCA0MiwgMC45KTsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgfQogICAgLnBmX2l0ZW06aG92ZXIgeyBiYWNrZ3JvdW5kOiByZ2JhKDQ0LCA0NCwgNTIsIDAuOTUpOyBib3JkZXItY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC4zMik7IH0KICAgIC5wZl90aXRsZSB7IGZvbnQtd2VpZ2h0OiA4MDA7IG1hcmdpbi1ib3R0b206IDRweDsgfQogICAgLnBmX2JvZHkgeyBmb250LWZhbWlseTogdWktbW9ub3NwYWNlLCBTRk1vbm8tUmVndWxhciwgTWVubG8sIE1vbmFjbywgQ29uc29sYXMsIG1vbm9zcGFjZTsgZm9udC1zaXplOiAxMXB4OyBjb2xvcjogcmdiYSgyMzAsMjMwLDIzNSwwLjgpOyB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7IG1heC1oZWlnaHQ6IDExMHB4OyBvdmVyZmxvdzogaGlkZGVuOyB9CgogICAgLnBmX2lubGluZV9hY3Rpb25zIHsgZGlzcGxheTpmbGV4OyBnYXA6NnB4OyBtYXJnaW4tdG9wOjhweDsgZmxleC13cmFwOiB3cmFwOyB9CiAgICAucGZfc21hbGxidG4gewogICAgICBwYWRkaW5nOiA0cHggOHB4OwogICAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMTQpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDE4LDE4LDIyLDAuOSk7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICBjb2xvcjogcmdiYSgyMzAsMjMwLDIzNSwwLjkyKTsKICAgIH0KICAgIC5wZl9zbWFsbGJ0bjpob3ZlciB7IGJvcmRlci1jb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwwLjMyKTsgYmFja2dyb3VuZDogcmdiYSgyNiwyNiwzMiwwLjk1KTsgfQogICAgLnBmX3NtYWxsYnRuW2Rpc2FibGVkXSB7IG9wYWNpdHk6IDAuNDU7IGN1cnNvcjogZGVmYXVsdDsgfQoKICAgICNwZl9jbG9zZSB7CiAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgZm9udC1zaXplOiAxNnB4OwogICAgICBwYWRkaW5nOiA2cHggOHB4OwogICAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgICBjb2xvcjogI2U2ZTZlYjsKICAgIH0KICAgICNwZl9jbG9zZTpob3ZlciB7IGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4wOCk7IH0KCiAgICAucGZfaGVscCB7IGZvbnQtc2l6ZTogMTJweDsgb3BhY2l0eTogMC44OyBsaW5lLWhlaWdodDogMS4zNTsgfQogICAgLnBmX3R3byB7IGRpc3BsYXk6Z3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyOyBnYXA6IDhweDsgfQogIGApOwoKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIC8vIFVJCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICBmdW5jdGlvbiBidWlsZFVJKCkgewogICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZl9idG4nKSkgcmV0dXJuOwoKICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgYnRuLmlkID0gJ3BmX2J0bic7CiAgICBidG4udGV4dENvbnRlbnQgPSAn8J+TjiBQcm9tcHRzJzsKCiAgICBjb25zdCBwYW5lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgcGFuZWwuaWQgPSAncGZfcGFuZWwnOwoKICAgIHBhbmVsLmlubmVySFRNTCA9IGAKICAgICAgPGhlYWRlcj4KICAgICAgICA8ZGl2IGNsYXNzPSJwZl90YWJzIj4KICAgICAgICAgIDxkaXYgY2xhc3M9InBmX3RhYiBhY3RpdmUiIGRhdGEtdGFiPSJ1c2UiPlVzZTwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0icGZfdGFiIiBkYXRhLXRhYj0ibWFuYWdlIj5NYW5hZ2U8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJwZl9yb3ciPgogICAgICAgICAgPGxhYmVsIGNsYXNzPSJwZl90b2dnbGUiIHRpdGxlPSJXaGVuIGVuYWJsZWQsIHNlbGVjdGluZyBhIHByb21wdCB3aWxsIHNlbmQgaXQgaW1tZWRpYXRlbHkuIj4KICAgICAgICAgICAgPGlucHV0IGlkPSJwZl9hdXRvc2VuZCIgdHlwZT0iY2hlY2tib3giIC8+CiAgICAgICAgICAgIEF1dG8tc2VuZAogICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgIDxidXR0b24gaWQ9InBmX2Nsb3NlIiBhcmlhLWxhYmVsPSJDbG9zZSI+4pyVPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvaGVhZGVyPgoKICAgICAgPGRpdiBpZD0icGZfdGFiX3VzZSI+CiAgICAgICAgPGlucHV0IGlkPSJwZl9zZWFyY2giIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJGaWx0ZXIgcHJvbXB0cyAodGl0bGUgb3IgdGV4dCkuLi4iIC8+CiAgICAgICAgPGRpdiBpZD0icGZfbGlzdCIgc3R5bGU9Im1hcmdpbi10b3A6MTBweDsiPjwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgaWQ9InBmX3RhYl9tYW5hZ2UiIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJwZl9oZWxwIj4KICAgICAgICAgIEV2ZXJ5dGhpbmcgaGVyZSBpcyBzdG9yZWQgbG9jYWxseSBpbiBUYW1wZXJtb25rZXkuIE5vIG5ldHdvcmsgY2FsbHMsIG5vIHN5bmMsIG5vIHN1cnByaXNlcy4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBjbGFzcz0icGZfc2VjdGlvbiI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJwZl9ncm91cCI+Q2F0ZWdvcmllczwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0icGZfdHdvIj4KICAgICAgICAgICAgPGlucHV0IGlkPSJwZl9uZXdjYXRfbmFtZSIgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9Ik5ldyBjYXRlZ29yeSBuYW1lLi4uIiAvPgogICAgICAgICAgICA8YnV0dG9uIGlkPSJwZl9hZGRjYXQiIGNsYXNzPSJwZl9idG4yIj5BZGQgY2F0ZWdvcnk8L2J1dHRvbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBpZD0icGZfY2F0cyIgc3R5bGU9Im1hcmdpbi10b3A6OHB4OyI+PC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9InBmX3NlY3Rpb24iPgogICAgICAgICAgPGRpdiBjbGFzcz0icGZfZ3JvdXAiPlByb21wdHM8L2Rpdj4KCiAgICAgICAgICA8ZGl2IGNsYXNzPSJwZl90d28iPgogICAgICAgICAgICA8YnV0dG9uIGlkPSJwZl9uZXdwcm9tcHQiIGNsYXNzPSJwZl9idG4yIj5OZXcgcHJvbXB0PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InBmX3Jlc2V0IiBjbGFzcz0icGZfYnRuMiIgdGl0bGU9IkNsZWFyIGFsbCBwcm9tcHRzL2NhdGVnb3JpZXMgb3IgcmVzdG9yZSBzYW1wbGUgbGlicmFyeS4iPlJlc2V0IGxpYnJhcnk8L2J1dHRvbj4KICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgIDxkaXYgY2xhc3M9InBmX3R3byIgc3R5bGU9Im1hcmdpbi10b3A6OHB4OyI+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InBmX2V4cG9ydCIgY2xhc3M9InBmX2J0bjIiIHRpdGxlPSJEb3dubG9hZCB5b3VyIGxpYnJhcnkgYXMgSlNPTi4iPkV4cG9ydCBKU09OPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InBmX2ltcG9ydCIgY2xhc3M9InBmX2J0bjIiIHRpdGxlPSJJbXBvcnQgYSBKU09OIGxpYnJhcnkgZmlsZSAocmVwbGFjZXMgY3VycmVudCkuIj5JbXBvcnQgSlNPTjwvYnV0dG9uPgogICAgICAgICAgPC9kaXY+CgogICAgICAgICAgPGlucHV0IGlkPSJwZl9pbXBvcnRfZmlsZSIgdHlwZT0iZmlsZSIgYWNjZXB0PSJhcHBsaWNhdGlvbi9qc29uLC5qc29uIiBzdHlsZT0iZGlzcGxheTpub25lOyIgLz4KCiAgICAgICAgICA8ZGl2IGlkPSJwZl9lZGl0b3IiIHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7Ij48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICBgOwoKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYnRuKTsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocGFuZWwpOwoKICAgIC8vIFN0YXRlIChpbiBjbG9zdXJlIHNvIGhhbmRsZXJzIGNhbiB1cGRhdGUpCiAgICBsZXQgYWN0aXZlVGFiID0gJ3VzZSc7CiAgICBsZXQgZWRpdGluZ1Byb21wdElkID0gbnVsbDsKCiAgICAvLyBET00gcmVmcwogICAgY29uc3QgZWxDbG9zZSA9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoJyNwZl9jbG9zZScpOwogICAgY29uc3QgZWxBdXRvU2VuZCA9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoJyNwZl9hdXRvc2VuZCcpOwogICAgY29uc3QgZWxTZWFyY2ggPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCcjcGZfc2VhcmNoJyk7CiAgICBjb25zdCBlbExpc3QgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCcjcGZfbGlzdCcpOwogICAgY29uc3QgZWxUYWJVc2UgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCcjcGZfdGFiX3VzZScpOwogICAgY29uc3QgZWxUYWJNYW5hZ2UgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCcjcGZfdGFiX21hbmFnZScpOwoKICAgIGNvbnN0IGVsQ2F0cyA9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoJyNwZl9jYXRzJyk7CiAgICBjb25zdCBlbE5ld0NhdE5hbWUgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCcjcGZfbmV3Y2F0X25hbWUnKTsKICAgIGNvbnN0IGVsQWRkQ2F0ID0gcGFuZWwucXVlcnlTZWxlY3RvcignI3BmX2FkZGNhdCcpOwoKICAgIGNvbnN0IGVsRWRpdG9yID0gcGFuZWwucXVlcnlTZWxlY3RvcignI3BmX2VkaXRvcicpOwogICAgY29uc3QgZWxOZXdQcm9tcHQgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCcjcGZfbmV3cHJvbXB0Jyk7CiAgICBjb25zdCBlbFJlc2V0ID0gcGFuZWwucXVlcnlTZWxlY3RvcignI3BmX3Jlc2V0Jyk7CgogICAgY29uc3QgZWxFeHBvcnQgPSBwYW5lbC5xdWVyeVNlbGVjdG9yKCcjcGZfZXhwb3J0Jyk7CiAgICBjb25zdCBlbEltcG9ydCA9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoJyNwZl9pbXBvcnQnKTsKICAgIGNvbnN0IGVsSW1wb3J0RmlsZSA9IHBhbmVsLnF1ZXJ5U2VsZWN0b3IoJyNwZl9pbXBvcnRfZmlsZScpOwoKICAgIGZ1bmN0aW9uIHNob3dQYW5lbCgpIHsKICAgICAgcGFuZWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgIGVsQXV0b1NlbmQuY2hlY2tlZCA9IGdldEF1dG9TZW5kKCk7CiAgICAgIHJlbmRlckFsbCgpOwogICAgICAoYWN0aXZlVGFiID09PSAndXNlJyA/IGVsU2VhcmNoIDogZWxOZXdDYXROYW1lKS5mb2N1cygpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhpZGVQYW5lbCgpIHsKICAgICAgcGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgZWRpdGluZ1Byb21wdElkID0gbnVsbDsKICAgIH0KCiAgICBlbENsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGlkZVBhbmVsKTsKCiAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgIGlmIChwYW5lbC5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScgfHwgIXBhbmVsLnN0eWxlLmRpc3BsYXkpIHNob3dQYW5lbCgpOwogICAgICBlbHNlIGhpZGVQYW5lbCgpOwogICAgfSk7CgogICAgZWxBdXRvU2VuZC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gc2V0QXV0b1NlbmQoZS50YXJnZXQuY2hlY2tlZCkpOwoKICAgIHBhbmVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZl90YWInKS5mb3JFYWNoKHRhYiA9PiB7CiAgICAgIHRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBhY3RpdmVUYWIgPSB0YWIuZGF0YXNldC50YWI7CiAgICAgICAgcGFuZWwucXVlcnlTZWxlY3RvckFsbCgnLnBmX3RhYicpLmZvckVhY2godCA9PiB0LmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIHQuZGF0YXNldC50YWIgPT09IGFjdGl2ZVRhYikpOwogICAgICAgIGVsVGFiVXNlLnN0eWxlLmRpc3BsYXkgPSBhY3RpdmVUYWIgPT09ICd1c2UnID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgICBlbFRhYk1hbmFnZS5zdHlsZS5kaXNwbGF5ID0gYWN0aXZlVGFiID09PSAnbWFuYWdlJyA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgcmVuZGVyQWxsKCk7CiAgICAgIH0pOwogICAgfSk7CgogICAgZWxTZWFyY2guYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiByZW5kZXJVc2VMaXN0KGVsU2VhcmNoLnZhbHVlKSk7CgogICAgLy8gLS0tLSBDYXRlZ29yeSBhY3Rpb25zIC0tLS0KICAgIGVsQWRkQ2F0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICBjb25zdCBuYW1lID0gKGVsTmV3Q2F0TmFtZS52YWx1ZSB8fCAnJykudHJpbSgpOwogICAgICBpZiAoIW5hbWUpIHJldHVybjsKICAgICAgY29uc3QgZGF0YSA9IGxvYWRMaWJyYXJ5KCk7CiAgICAgIGRhdGEuY2F0ZWdvcmllcy5wdXNoKHsgaWQ6IHVpZCgnY2F0JyksIG5hbWUgfSk7CiAgICAgIHNhdmVMaWJyYXJ5KGRhdGEpOwogICAgICBlbE5ld0NhdE5hbWUudmFsdWUgPSAnJzsKICAgICAgcmVuZGVyTWFuYWdlKCk7CiAgICB9KTsKCiAgICAvLyAtLS0tIFByb21wdCBhY3Rpb25zIC0tLS0KICAgIGVsTmV3UHJvbXB0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICBlZGl0aW5nUHJvbXB0SWQgPSAnTkVXJzsKICAgICAgcmVuZGVyRWRpdG9yKCk7CiAgICB9KTsKCiAgICBlbFJlc2V0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICBjb25zdCBjaG9pY2UgPSBwcm9tcHQoCiAgICAgICAgJ1Jlc2V0IGxpYnJhcnk6XG4nICsKICAgICAgICAnVHlwZSBDTEVBUiB0byBkZWxldGUgYWxsIGNhdGVnb3JpZXMvcHJvbXB0cy5cbicgKwogICAgICAgICdUeXBlIFNBTVBMRSB0byByZXN0b3JlIHRoZSBzYW1wbGUgbGlicmFyeS5cbicgKwogICAgICAgICdBbnl0aGluZyBlbHNlIGNhbmNlbHMuJwogICAgICApOwogICAgICBpZiAoIWNob2ljZSkgcmV0dXJuOwoKICAgICAgY29uc3QgdXBwZXIgPSBjaG9pY2UudHJpbSgpLnRvVXBwZXJDYXNlKCk7CgogICAgICBpZiAodXBwZXIgPT09ICdDTEVBUicpIHsKICAgICAgICBzYXZlTGlicmFyeSh7IGNhdGVnb3JpZXM6IFtdLCBwcm9tcHRzOiBbXSB9KTsKICAgICAgICBlZGl0aW5nUHJvbXB0SWQgPSBudWxsOwogICAgICAgIHJlbmRlck1hbmFnZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAodXBwZXIgPT09ICdTQU1QTEUnKSB7CiAgICAgICAgY29uc3Qgc2VlZCA9IHN0cnVjdHVyZWRDbG9uZQogICAgICAgICAgPyBzdHJ1Y3R1cmVkQ2xvbmUoU0FNUExFX0xJQlJBUlkpCiAgICAgICAgICA6IHNhZmVKc29uUGFyc2UoSlNPTi5zdHJpbmdpZnkoU0FNUExFX0xJQlJBUlkpLCBTQU1QTEVfTElCUkFSWSk7CiAgICAgICAgc2F2ZUxpYnJhcnkoc2VlZCk7CiAgICAgICAgZWRpdGluZ1Byb21wdElkID0gbnVsbDsKICAgICAgICByZW5kZXJNYW5hZ2UoKTsKICAgICAgfQogICAgfSk7CgogICAgLy8gLS0tLSBFeHBvcnQgLyBJbXBvcnQgLS0tLQogICAgZWxFeHBvcnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgIGNvbnN0IGRhdGEgPSBsb2FkTGlicmFyeSgpOwogICAgICBub3JtYWxpemVMaWJyYXJ5KGRhdGEpOwoKICAgICAgY29uc3QgcGF5bG9hZCA9IHsKICAgICAgICBtZXRhOiB7CiAgICAgICAgICBleHBvcnRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICBzY2hlbWE6ICdwZl9saWJyYXJ5X3YxJywKICAgICAgICAgIHNjcmlwdFZlcnNpb246ICcwLjQuMCcKICAgICAgICB9LAogICAgICAgIGRhdGEKICAgICAgfTsKCiAgICAgIGNvbnN0IGpzb24gPSBKU09OLnN0cmluZ2lmeShwYXlsb2FkLCBudWxsLCAyKTsKICAgICAgY29uc3Qgc3RhbXAgPSBwYXlsb2FkLm1ldGEuZXhwb3J0ZWRBdC5yZXBsYWNlKC9bOi5dL2csICctJyk7CiAgICAgIGRvd25sb2FkVGV4dEZpbGUoYGNoYXRncHQtcHJvbXB0cy0ke3N0YW1wfS5qc29uYCwganNvbik7CiAgICB9KTsKCiAgICBlbEltcG9ydC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgZWxJbXBvcnRGaWxlLnZhbHVlID0gJyc7CiAgICAgIGVsSW1wb3J0RmlsZS5jbGljaygpOwogICAgfSk7CgogICAgZWxJbXBvcnRGaWxlLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGFzeW5jICgpID0+IHsKICAgICAgY29uc3QgZmlsZSA9IGVsSW1wb3J0RmlsZS5maWxlcz8uWzBdOwogICAgICBpZiAoIWZpbGUpIHJldHVybjsKCiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCBmaWxlLnRleHQoKTsKICAgICAgY29uc3QgcGFyc2VkID0gc2FmZUpzb25QYXJzZSh0ZXh0LCBudWxsKTsKICAgICAgaWYgKCFwYXJzZWQpIHsKICAgICAgICBhbGVydCgnSW1wb3J0IGZhaWxlZDogZmlsZSB3YXMgbm90IHZhbGlkIEpTT04uJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBTdXBwb3J0IGVpdGhlciB7bWV0YSxkYXRhfSB3cmFwcGVyIG9yIHJhdyB7Y2F0ZWdvcmllcyxwcm9tcHRzfQogICAgICBjb25zdCBjYW5kaWRhdGUgPSAocGFyc2VkICYmIHBhcnNlZC5kYXRhICYmIHBhcnNlZC5tZXRhKSA/IHBhcnNlZC5kYXRhIDogcGFyc2VkOwoKICAgICAgY29uc3QgdiA9IHZhbGlkYXRlTGlicmFyeVNoYXBlKGNhbmRpZGF0ZSk7CiAgICAgIGlmICghdi5vaykgewogICAgICAgIGFsZXJ0KGBJbXBvcnQgZmFpbGVkOiAke3YuZXJyb3J9YCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBjdXJyZW50ID0gbG9hZExpYnJhcnkoKTsKCiAgICAgIGNvbnN0IG9rID0gY29uZmlybSgKICAgICAgICBgSW1wb3J0IHdpbGwgUkVQTEFDRSB5b3VyIGN1cnJlbnQgbGlicmFyeS5cblxuYCArCiAgICAgICAgYEN1cnJlbnQ6ICR7Y3VycmVudC5jYXRlZ29yaWVzLmxlbmd0aH0gY2F0ZWdvcmllcywgJHtjdXJyZW50LnByb21wdHMubGVuZ3RofSBwcm9tcHRzXG5gICsKICAgICAgICBgSW5jb21pbmc6ICR7Y2FuZGlkYXRlLmNhdGVnb3JpZXMubGVuZ3RofSBjYXRlZ29yaWVzLCAke2NhbmRpZGF0ZS5wcm9tcHRzLmxlbmd0aH0gcHJvbXB0c1xuXG5gICsKICAgICAgICBgUHJvY2VlZD9gCiAgICAgICk7CiAgICAgIGlmICghb2spIHJldHVybjsKCiAgICAgIC8vIFNhdmUgcm9sbGJhY2sgc25hcHNob3QgKGxvY2FsIHN0b3JhZ2UpCiAgICAgIHRyeSB7CiAgICAgICAgR01fc2V0VmFsdWUoS0VZX0JBQ0tVUF9MQVNULCBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICBtZXRhOiB7IGJhY2tlZFVwQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwgc2NoZW1hOiAncGZfbGlicmFyeV92MScsIHNjcmlwdFZlcnNpb246ICcwLjQuMCcgfSwKICAgICAgICAgIGRhdGE6IGN1cnJlbnQKICAgICAgICB9KSk7CiAgICAgIH0gY2F0Y2ggeyAvKiBpZ25vcmUgKi8gfQoKICAgICAgc2F2ZUxpYnJhcnkoY2FuZGlkYXRlKTsKICAgICAgZWRpdGluZ1Byb21wdElkID0gbnVsbDsKICAgICAgcmVuZGVyQWxsKCk7CiAgICB9KTsKCiAgICAvLyAtLS0tIFJlbmRlcmVycyAtLS0tCiAgICBmdW5jdGlvbiByZW5kZXJBbGwoKSB7CiAgICAgIGlmIChhY3RpdmVUYWIgPT09ICd1c2UnKSByZW5kZXJVc2VMaXN0KGVsU2VhcmNoLnZhbHVlKTsKICAgICAgZWxzZSByZW5kZXJNYW5hZ2UoKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW5kZXJVc2VMaXN0KGZpbHRlclRleHQpIHsKICAgICAgY29uc3QgZGF0YSA9IGxvYWRMaWJyYXJ5KCk7CiAgICAgIG5vcm1hbGl6ZUxpYnJhcnkoZGF0YSk7CgogICAgICBjb25zdCBmID0gKGZpbHRlclRleHQgfHwgJycpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwoKICAgICAgY29uc3QgY2F0cyA9IGRhdGEuY2F0ZWdvcmllczsKICAgICAgY29uc3QgcHJvbXB0cyA9IGRhdGEucHJvbXB0czsKCiAgICAgIGNvbnN0IGh0bWwgPSBjYXRzLm1hcChjYXQgPT4gewogICAgICAgIGNvbnN0IGNhdFByb21wdHMgPSBwcm9tcHRzCiAgICAgICAgICAuZmlsdGVyKHAgPT4gcC5jYXRlZ29yeUlkID09PSBjYXQuaWQpCiAgICAgICAgICAuZmlsdGVyKHAgPT4gewogICAgICAgICAgICBpZiAoIWYpIHJldHVybiB0cnVlOwogICAgICAgICAgICByZXR1cm4gcC50aXRsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGYpIHx8IHAuYm9keS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGYpOwogICAgICAgICAgfSk7CgogICAgICAgIGlmICghY2F0UHJvbXB0cy5sZW5ndGgpIHJldHVybiAnJzsKCiAgICAgICAgY29uc3QgaXRlbXNIdG1sID0gY2F0UHJvbXB0cy5tYXAocCA9PiBgCiAgICAgICAgICA8ZGl2IGNsYXNzPSJwZl9pdGVtIiBkYXRhLXByb21wdC1pZD0iJHtlc2NIdG1sKHAuaWQpfSI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InBmX3RpdGxlIj4ke2VzY0h0bWwocC50aXRsZSl9PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InBmX2JvZHkiPiR7ZXNjSHRtbChwLmJvZHkpfTwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgYCkuam9pbignJyk7CgogICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0icGZfZ3JvdXAiPiR7ZXNjSHRtbChjYXQubmFtZSl9PC9kaXY+JHtpdGVtc0h0bWx9YDsKICAgICAgfSkuam9pbignJyk7CgogICAgICBlbExpc3QuaW5uZXJIVE1MID0gaHRtbCB8fCBgPGRpdiBjbGFzcz0icGZfaGVscCI+Tm8gcHJvbXB0cyBtYXRjaCB5b3VyIGZpbHRlciDigJQgb3IgeW91ciBsaWJyYXJ5IGlzIGVtcHR5LiBTd2l0Y2ggdG8g4oCcTWFuYWdl4oCdIHRvIGFkZCBzb21lLjwvZGl2PmA7CgogICAgICBlbExpc3QucXVlcnlTZWxlY3RvckFsbCgnLnBmX2l0ZW0nKS5mb3JFYWNoKG5vZGUgPT4gewogICAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICBjb25zdCBwaWQgPSBub2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1wcm9tcHQtaWQnKTsKICAgICAgICAgIGNvbnN0IGRhdGEyID0gbG9hZExpYnJhcnkoKTsKICAgICAgICAgIGNvbnN0IHByb21wdE9iaiA9IGRhdGEyLnByb21wdHMuZmluZChwID0+IHAuaWQgPT09IHBpZCk7CiAgICAgICAgICBpZiAoIXByb21wdE9iaikgcmV0dXJuOwoKICAgICAgICAgIGNvbnN0IGNvbXBvc2VyID0gZmluZENvbXBvc2VyRWxlbWVudCgpOwogICAgICAgICAgaWYgKCFjb21wb3NlcikgewogICAgICAgICAgICBhbGVydCgnQ291bGQgbm90IGZpbmQgdGhlIENoYXRHUFQgbWVzc2FnZSBib3guIFRoZSBVSSBtYXkgaGF2ZSBjaGFuZ2VkLicpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgc2V0Q29tcG9zZXJUZXh0KGNvbXBvc2VyLCBwcm9tcHRPYmouYm9keSk7CiAgICAgICAgICBhd2FpdCBzbGVlcCg2MCk7CiAgICAgICAgICBhd2FpdCBjbGlja1NlbmRJZkVuYWJsZWQoKTsKICAgICAgICAgIGhpZGVQYW5lbCgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW5kZXJNYW5hZ2UoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSBsb2FkTGlicmFyeSgpOwogICAgICBub3JtYWxpemVMaWJyYXJ5KGRhdGEpOwogICAgICBzYXZlTGlicmFyeShkYXRhKTsKCiAgICAgIHJlbmRlckNhdGVnb3JpZXMoKTsKICAgICAgcmVuZGVyRWRpdG9yKCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVuZGVyQ2F0ZWdvcmllcygpIHsKICAgICAgY29uc3QgZGF0YSA9IGxvYWRMaWJyYXJ5KCk7CgogICAgICBpZiAoIWRhdGEuY2F0ZWdvcmllcy5sZW5ndGgpIHsKICAgICAgICBlbENhdHMuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9InBmX2hlbHAiPk5vIGNhdGVnb3JpZXMgeWV0LiBBZGQgb25lIGFib3ZlLjwvZGl2PmA7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBlbENhdHMuaW5uZXJIVE1MID0gZGF0YS5jYXRlZ29yaWVzLm1hcCgoYywgaWR4KSA9PiBgCiAgICAgICAgPGRpdiBjbGFzcz0icGZfaXRlbSIgc3R5bGU9ImN1cnNvcjogZGVmYXVsdDsiPgogICAgICAgICAgPGRpdiBjbGFzcz0icGZfdGl0bGUiPiR7ZXNjSHRtbChjLm5hbWUpfTwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0icGZfaW5saW5lX2FjdGlvbnMiPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwZl9zbWFsbGJ0biIgZGF0YS1hY3Q9ImNhdF91cCIgZGF0YS1pZD0iJHtlc2NIdG1sKGMuaWQpfSIgJHtpZHggPT09IDAgPyAnZGlzYWJsZWQnIDogJyd9PuKGkTwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwZl9zbWFsbGJ0biIgZGF0YS1hY3Q9ImNhdF9kb3duIiBkYXRhLWlkPSIke2VzY0h0bWwoYy5pZCl9IiAke2lkeCA9PT0gZGF0YS5jYXRlZ29yaWVzLmxlbmd0aCAtIDEgPyAnZGlzYWJsZWQnIDogJyd9PuKGkzwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwZl9zbWFsbGJ0biIgZGF0YS1hY3Q9ImNhdF9yZW5hbWUiIGRhdGEtaWQ9IiR7ZXNjSHRtbChjLmlkKX0iPlJlbmFtZTwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwZl9zbWFsbGJ0biIgZGF0YS1hY3Q9ImNhdF9kZWxldGUiIGRhdGEtaWQ9IiR7ZXNjSHRtbChjLmlkKX0iPkRlbGV0ZTwvYnV0dG9uPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIGApLmpvaW4oJycpOwoKICAgICAgZWxDYXRzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbltkYXRhLWFjdF0nKS5mb3JFYWNoKGIgPT4gewogICAgICAgIGIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICBjb25zdCBhY3QgPSBiLmRhdGFzZXQuYWN0OwogICAgICAgICAgY29uc3QgaWQgPSBiLmRhdGFzZXQuaWQ7CiAgICAgICAgICBjb25zdCBkYXRhMiA9IGxvYWRMaWJyYXJ5KCk7CgogICAgICAgICAgY29uc3QgaWR4ID0gZGF0YTIuY2F0ZWdvcmllcy5maW5kSW5kZXgoeCA9PiB4LmlkID09PSBpZCk7CiAgICAgICAgICBpZiAoaWR4IDwgMCkgcmV0dXJuOwoKICAgICAgICAgIGlmIChhY3QgPT09ICdjYXRfdXAnICYmIGlkeCA+IDApIHsKICAgICAgICAgICAgW2RhdGEyLmNhdGVnb3JpZXNbaWR4IC0gMV0sIGRhdGEyLmNhdGVnb3JpZXNbaWR4XV0gPSBbZGF0YTIuY2F0ZWdvcmllc1tpZHhdLCBkYXRhMi5jYXRlZ29yaWVzW2lkeCAtIDFdXTsKICAgICAgICAgICAgc2F2ZUxpYnJhcnkoZGF0YTIpOwogICAgICAgICAgICByZW5kZXJDYXRlZ29yaWVzKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChhY3QgPT09ICdjYXRfZG93bicgJiYgaWR4IDwgZGF0YTIuY2F0ZWdvcmllcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIFtkYXRhMi5jYXRlZ29yaWVzW2lkeCArIDFdLCBkYXRhMi5jYXRlZ29yaWVzW2lkeF1dID0gW2RhdGEyLmNhdGVnb3JpZXNbaWR4XSwgZGF0YTIuY2F0ZWdvcmllc1tpZHggKyAxXV07CiAgICAgICAgICAgIHNhdmVMaWJyYXJ5KGRhdGEyKTsKICAgICAgICAgICAgcmVuZGVyQ2F0ZWdvcmllcygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYWN0ID09PSAnY2F0X3JlbmFtZScpIHsKICAgICAgICAgICAgY29uc3QgbmV3TmFtZSA9IHByb21wdCgnUmVuYW1lIGNhdGVnb3J5OicsIGRhdGEyLmNhdGVnb3JpZXNbaWR4XS5uYW1lKTsKICAgICAgICAgICAgaWYgKCFuZXdOYW1lKSByZXR1cm47CiAgICAgICAgICAgIGRhdGEyLmNhdGVnb3JpZXNbaWR4XS5uYW1lID0gbmV3TmFtZS50cmltKCkgfHwgZGF0YTIuY2F0ZWdvcmllc1tpZHhdLm5hbWU7CiAgICAgICAgICAgIHNhdmVMaWJyYXJ5KGRhdGEyKTsKICAgICAgICAgICAgcmVuZGVyQ2F0ZWdvcmllcygpOwogICAgICAgICAgICByZW5kZXJFZGl0b3IoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGFjdCA9PT0gJ2NhdF9kZWxldGUnKSB7CiAgICAgICAgICAgIGNvbnN0IGNhdCA9IGRhdGEyLmNhdGVnb3JpZXNbaWR4XTsKICAgICAgICAgICAgY29uc3QgY291bnQgPSBkYXRhMi5wcm9tcHRzLmZpbHRlcihwID0+IHAuY2F0ZWdvcnlJZCA9PT0gY2F0LmlkKS5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IG9rID0gY29uZmlybShgRGVsZXRlIGNhdGVnb3J5ICIke2NhdC5uYW1lfSI/XG5UaGlzIHdpbGwgYWxzbyBkZWxldGUgJHtjb3VudH0gcHJvbXB0KHMpIGluIGl0LmApOwogICAgICAgICAgICBpZiAoIW9rKSByZXR1cm47CgogICAgICAgICAgICBkYXRhMi5jYXRlZ29yaWVzID0gZGF0YTIuY2F0ZWdvcmllcy5maWx0ZXIoYyA9PiBjLmlkICE9PSBjYXQuaWQpOwogICAgICAgICAgICBkYXRhMi5wcm9tcHRzID0gZGF0YTIucHJvbXB0cy5maWx0ZXIocCA9PiBwLmNhdGVnb3J5SWQgIT09IGNhdC5pZCk7CiAgICAgICAgICAgIHNhdmVMaWJyYXJ5KGRhdGEyKTsKCiAgICAgICAgICAgIGlmIChlZGl0aW5nUHJvbXB0SWQgJiYgZWRpdGluZ1Byb21wdElkICE9PSAnTkVXJykgewogICAgICAgICAgICAgIGNvbnN0IHN0aWxsRXhpc3RzID0gZGF0YTIucHJvbXB0cy5zb21lKHAgPT4gcC5pZCA9PT0gZWRpdGluZ1Byb21wdElkKTsKICAgICAgICAgICAgICBpZiAoIXN0aWxsRXhpc3RzKSBlZGl0aW5nUHJvbXB0SWQgPSBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZW5kZXJNYW5hZ2UoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVuZGVyRWRpdG9yKCkgewogICAgICBjb25zdCBkYXRhID0gbG9hZExpYnJhcnkoKTsKCiAgICAgIGNvbnN0IHByb21wdHNCeUNhdCA9IGRhdGEuY2F0ZWdvcmllcy5tYXAoY2F0ID0+IHsKICAgICAgICBjb25zdCBwcyA9IGRhdGEucHJvbXB0cy5maWx0ZXIocCA9PiBwLmNhdGVnb3J5SWQgPT09IGNhdC5pZCk7CiAgICAgICAgaWYgKCFwcy5sZW5ndGgpIHJldHVybiAnJzsKCiAgICAgICAgY29uc3Qgcm93cyA9IHBzLm1hcCgocCwgaWR4KSA9PiBgCiAgICAgICAgICA8ZGl2IGNsYXNzPSJwZl9pdGVtIiBzdHlsZT0iY3Vyc29yOiBkZWZhdWx0OyI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InBmX3RpdGxlIj4ke2VzY0h0bWwocC50aXRsZSl9PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InBmX2hlbHAiPkNhdGVnb3J5OiAke2VzY0h0bWwoY2F0Lm5hbWUpfTwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwZl9pbmxpbmVfYWN0aW9ucyI+CiAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0icGZfc21hbGxidG4iIGRhdGEtYWN0PSJwX3VwIiBkYXRhLWlkPSIke2VzY0h0bWwocC5pZCl9IiAke2lkeCA9PT0gMCA/ICdkaXNhYmxlZCcgOiAnJ30+4oaRPC9idXR0b24+CiAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0icGZfc21hbGxidG4iIGRhdGEtYWN0PSJwX2Rvd24iIGRhdGEtaWQ9IiR7ZXNjSHRtbChwLmlkKX0iICR7aWR4ID09PSBwcy5sZW5ndGggLSAxID8gJ2Rpc2FibGVkJyA6ICcnfT7ihpM8L2J1dHRvbj4KICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwZl9zbWFsbGJ0biIgZGF0YS1hY3Q9InBfZWRpdCIgZGF0YS1pZD0iJHtlc2NIdG1sKHAuaWQpfSI+RWRpdDwvYnV0dG9uPgogICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InBmX3NtYWxsYnRuIiBkYXRhLWFjdD0icF9kZWxldGUiIGRhdGEtaWQ9IiR7ZXNjSHRtbChwLmlkKX0iPkRlbGV0ZTwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIGApLmpvaW4oJycpOwoKICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9InBmX2dyb3VwIj4ke2VzY0h0bWwoY2F0Lm5hbWUpfTwvZGl2PiR7cm93c31gOwogICAgICB9KS5qb2luKCcnKTsKCiAgICAgIGNvbnN0IHByb21wdExpc3RIdG1sID0gcHJvbXB0c0J5Q2F0IHx8IGA8ZGl2IGNsYXNzPSJwZl9oZWxwIj5ObyBwcm9tcHRzIHlldC4gQ2xpY2sg4oCcTmV3IHByb21wdOKAnSBhYm92ZS48L2Rpdj5gOwoKICAgICAgbGV0IGVkaXRpbmcgPSBudWxsOwogICAgICBpZiAoZWRpdGluZ1Byb21wdElkICYmIGVkaXRpbmdQcm9tcHRJZCAhPT0gJ05FVycpIHsKICAgICAgICBlZGl0aW5nID0gZGF0YS5wcm9tcHRzLmZpbmQocCA9PiBwLmlkID09PSBlZGl0aW5nUHJvbXB0SWQpIHx8IG51bGw7CiAgICAgIH0KCiAgICAgIGNvbnN0IGNhdE9wdGlvbnMgPSBkYXRhLmNhdGVnb3JpZXMubWFwKChjLCBpKSA9PiB7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPQogICAgICAgICAgKGVkaXRpbmdQcm9tcHRJZCA9PT0gJ05FVycgJiYgaSA9PT0gMCkgfHwKICAgICAgICAgIChlZGl0aW5nICYmIGVkaXRpbmcuY2F0ZWdvcnlJZCA9PT0gYy5pZCk7CiAgICAgICAgcmV0dXJuIGA8b3B0aW9uIHZhbHVlPSIke2VzY0h0bWwoYy5pZCl9IiAke3NlbGVjdGVkID8gJ3NlbGVjdGVkJyA6ICcnfT4ke2VzY0h0bWwoYy5uYW1lKX08L29wdGlvbj5gOwogICAgICB9KS5qb2luKCcnKTsKCiAgICAgIGNvbnN0IGVkaXRvckRpc2FibGVkID0gZGF0YS5jYXRlZ29yaWVzLmxlbmd0aCA9PT0gMDsKCiAgICAgIGNvbnN0IGVkaXRvckh0bWwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0icGZfZ3JvdXAiPlByb21wdCBlZGl0b3I8L2Rpdj4KICAgICAgICAke2VkaXRvckRpc2FibGVkID8gYDxkaXYgY2xhc3M9InBmX2hlbHAiPkNyZWF0ZSBhIGNhdGVnb3J5IGZpcnN0IChhYm92ZSksIHRoZW4geW91IGNhbiBhZGQgcHJvbXB0cy48L2Rpdj5gIDogYAogICAgICAgICAgPGRpdiBjbGFzcz0icGZfdHdvIj4KICAgICAgICAgICAgPGlucHV0IGlkPSJwZl9lZF90aXRsZSIgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9IlByb21wdCB0aXRsZS4uLiIgdmFsdWU9IiR7ZXNjSHRtbChlZGl0aW5nPy50aXRsZSA/PyAnJyl9IiAvPgogICAgICAgICAgICA8c2VsZWN0IGlkPSJwZl9lZF9jYXQiPiR7Y2F0T3B0aW9uc308L3NlbGVjdD4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDo4cHg7Ij4KICAgICAgICAgICAgPHRleHRhcmVhIGlkPSJwZl9lZF9ib2R5IiBwbGFjZWhvbGRlcj0iUHJvbXB0IGJvZHkuLi4iPiR7ZXNjSHRtbChlZGl0aW5nPy5ib2R5ID8/ICcnKX08L3RleHRhcmVhPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJwZl9pbmxpbmVfYWN0aW9ucyI+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InBmX2VkX3NhdmUiIGNsYXNzPSJwZl9zbWFsbGJ0biI+JHtlZGl0aW5nUHJvbXB0SWQgPT09ICdORVcnID8gJ0FkZCcgOiAnU2F2ZSd9PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InBmX2VkX2NhbmNlbCIgY2xhc3M9InBmX3NtYWxsYnRuIj5DYW5jZWw8L2J1dHRvbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0icGZfaGVscCIgc3R5bGU9Im1hcmdpbi10b3A6OHB4OyI+CiAgICAgICAgICAgIFRpcDoga2VlcCBwbGFjZWhvbGRlcnMgbGlrZSAmbHQ7UEFTVEUgSEVSRSZndDsgb3Ige3t0aGluZ319IGlmIHlvdSBsaWtlLiBUaGlzIHNjcmlwdCBqdXN0IGluc2VydHMgdGV4dC4KICAgICAgICAgIDwvZGl2PgogICAgICAgIGB9CiAgICAgIGA7CgogICAgICBlbEVkaXRvci5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0icGZfdHdvIj4KICAgICAgICAgIDxkaXY+JHtwcm9tcHRMaXN0SHRtbH08L2Rpdj4KICAgICAgICAgIDxkaXY+JHtlZGl0b3JIdG1sfTwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICBgOwoKICAgICAgLy8gUHJvbXB0IGxpc3QgYnV0dG9uIGhhbmRsZXJzCiAgICAgIGVsRWRpdG9yLnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbltkYXRhLWFjdF0nKS5mb3JFYWNoKGIgPT4gewogICAgICAgIGIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICBjb25zdCBhY3QgPSBiLmRhdGFzZXQuYWN0OwogICAgICAgICAgY29uc3QgaWQgPSBiLmRhdGFzZXQuaWQ7CiAgICAgICAgICBjb25zdCBkYXRhMiA9IGxvYWRMaWJyYXJ5KCk7CiAgICAgICAgICBjb25zdCBwSWR4ID0gZGF0YTIucHJvbXB0cy5maW5kSW5kZXgocCA9PiBwLmlkID09PSBpZCk7CiAgICAgICAgICBpZiAocElkeCA8IDApIHJldHVybjsKCiAgICAgICAgICBjb25zdCBwID0gZGF0YTIucHJvbXB0c1twSWR4XTsKCiAgICAgICAgICBpZiAoYWN0ID09PSAncF9lZGl0JykgewogICAgICAgICAgICBlZGl0aW5nUHJvbXB0SWQgPSBpZDsKICAgICAgICAgICAgcmVuZGVyRWRpdG9yKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoYWN0ID09PSAncF9kZWxldGUnKSB7CiAgICAgICAgICAgIGNvbnN0IG9rID0gY29uZmlybShgRGVsZXRlIHByb21wdCAiJHtwLnRpdGxlfSI/YCk7CiAgICAgICAgICAgIGlmICghb2spIHJldHVybjsKCiAgICAgICAgICAgIGRhdGEyLnByb21wdHMgPSBkYXRhMi5wcm9tcHRzLmZpbHRlcih4ID0+IHguaWQgIT09IGlkKTsKICAgICAgICAgICAgc2F2ZUxpYnJhcnkoZGF0YTIpOwogICAgICAgICAgICBpZiAoZWRpdGluZ1Byb21wdElkID09PSBpZCkgZWRpdGluZ1Byb21wdElkID0gbnVsbDsKICAgICAgICAgICAgcmVuZGVyRWRpdG9yKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyByZW9yZGVyIHdpdGhpbiBzYW1lIGNhdGVnb3J5CiAgICAgICAgICBjb25zdCBzYW1lQ2F0ID0gZGF0YTIucHJvbXB0cwogICAgICAgICAgICAubWFwKChwcCwgaWR4KSA9PiAoeyBwcCwgaWR4IH0pKQogICAgICAgICAgICAuZmlsdGVyKHggPT4geC5wcC5jYXRlZ29yeUlkID09PSBwLmNhdGVnb3J5SWQpOwoKICAgICAgICAgIGNvbnN0IGxvY2FsUG9zID0gc2FtZUNhdC5maW5kSW5kZXgoeCA9PiB4LnBwLmlkID09PSBpZCk7CiAgICAgICAgICBpZiAobG9jYWxQb3MgPCAwKSByZXR1cm47CgogICAgICAgICAgaWYgKGFjdCA9PT0gJ3BfdXAnICYmIGxvY2FsUG9zID4gMCkgewogICAgICAgICAgICBjb25zdCBhID0gc2FtZUNhdFtsb2NhbFBvcyAtIDFdLmlkeDsKICAgICAgICAgICAgY29uc3QgYyA9IHNhbWVDYXRbbG9jYWxQb3NdLmlkeDsKICAgICAgICAgICAgW2RhdGEyLnByb21wdHNbYV0sIGRhdGEyLnByb21wdHNbY11dID0gW2RhdGEyLnByb21wdHNbY10sIGRhdGEyLnByb21wdHNbYV1dOwogICAgICAgICAgICBzYXZlTGlicmFyeShkYXRhMik7CiAgICAgICAgICAgIHJlbmRlckVkaXRvcigpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGFjdCA9PT0gJ3BfZG93bicgJiYgbG9jYWxQb3MgPCBzYW1lQ2F0Lmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgY29uc3QgYyA9IHNhbWVDYXRbbG9jYWxQb3NdLmlkeDsKICAgICAgICAgICAgY29uc3QgZCA9IHNhbWVDYXRbbG9jYWxQb3MgKyAxXS5pZHg7CiAgICAgICAgICAgIFtkYXRhMi5wcm9tcHRzW2NdLCBkYXRhMi5wcm9tcHRzW2RdXSA9IFtkYXRhMi5wcm9tcHRzW2RdLCBkYXRhMi5wcm9tcHRzW2NdXTsKICAgICAgICAgICAgc2F2ZUxpYnJhcnkoZGF0YTIpOwogICAgICAgICAgICByZW5kZXJFZGl0b3IoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICAvLyBFZGl0b3IgYnV0dG9ucwogICAgICBjb25zdCBlZFNhdmUgPSBlbEVkaXRvci5xdWVyeVNlbGVjdG9yKCcjcGZfZWRfc2F2ZScpOwogICAgICBjb25zdCBlZENhbmNlbCA9IGVsRWRpdG9yLnF1ZXJ5U2VsZWN0b3IoJyNwZl9lZF9jYW5jZWwnKTsKCiAgICAgIGlmIChlZENhbmNlbCkgewogICAgICAgIGVkQ2FuY2VsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgZWRpdGluZ1Byb21wdElkID0gbnVsbDsKICAgICAgICAgIHJlbmRlckVkaXRvcigpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAoZWRTYXZlKSB7CiAgICAgICAgZWRTYXZlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgY29uc3QgZGF0YTIgPSBsb2FkTGlicmFyeSgpOwogICAgICAgICAgaWYgKGRhdGEyLmNhdGVnb3JpZXMubGVuZ3RoID09PSAwKSByZXR1cm47CgogICAgICAgICAgY29uc3QgdGl0bGUgPSAoZWxFZGl0b3IucXVlcnlTZWxlY3RvcignI3BmX2VkX3RpdGxlJyk/LnZhbHVlIHx8ICcnKS50cmltKCk7CiAgICAgICAgICBjb25zdCBib2R5ID0gKGVsRWRpdG9yLnF1ZXJ5U2VsZWN0b3IoJyNwZl9lZF9ib2R5Jyk/LnZhbHVlIHx8ICcnKS50cmltKCk7CiAgICAgICAgICBjb25zdCBjYXRlZ29yeUlkID0gZWxFZGl0b3IucXVlcnlTZWxlY3RvcignI3BmX2VkX2NhdCcpPy52YWx1ZTsKCiAgICAgICAgICBpZiAoIXRpdGxlIHx8ICFib2R5IHx8ICFjYXRlZ29yeUlkKSByZXR1cm47CgogICAgICAgICAgaWYgKGVkaXRpbmdQcm9tcHRJZCA9PT0gJ05FVycpIHsKICAgICAgICAgICAgZGF0YTIucHJvbXB0cy5wdXNoKHsgaWQ6IHVpZCgncCcpLCBjYXRlZ29yeUlkLCB0aXRsZSwgYm9keSB9KTsKICAgICAgICAgICAgc2F2ZUxpYnJhcnkoZGF0YTIpOwogICAgICAgICAgICBlZGl0aW5nUHJvbXB0SWQgPSBudWxsOwogICAgICAgICAgICByZW5kZXJFZGl0b3IoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IGlkeCA9IGRhdGEyLnByb21wdHMuZmluZEluZGV4KHAgPT4gcC5pZCA9PT0gZWRpdGluZ1Byb21wdElkKTsKICAgICAgICAgIGlmIChpZHggPCAwKSByZXR1cm47CgogICAgICAgICAgZGF0YTIucHJvbXB0c1tpZHhdLnRpdGxlID0gdGl0bGU7CiAgICAgICAgICBkYXRhMi5wcm9tcHRzW2lkeF0uYm9keSA9IGJvZHk7CiAgICAgICAgICBkYXRhMi5wcm9tcHRzW2lkeF0uY2F0ZWdvcnlJZCA9IGNhdGVnb3J5SWQ7CgogICAgICAgICAgc2F2ZUxpYnJhcnkoZGF0YTIpOwogICAgICAgICAgZWRpdGluZ1Byb21wdElkID0gbnVsbDsKICAgICAgICAgIHJlbmRlckVkaXRvcigpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgLy8gU3RhcnQgaGlkZGVuCiAgICBwYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIH0KCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAvLyBCb290c3RyYXAgLyBTUEEgcmVzaWxpZW5jZQogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgZnVuY3Rpb24gYm9vdHN0cmFwKCkgewogICAgYnVpbGRVSSgpOwoKICAgIGNvbnN0IG9icyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHsKICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGZfYnRuJykpIGJ1aWxkVUkoKTsKICAgIH0pOwogICAgb2JzLm9ic2VydmUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCB7IGNoaWxkTGlzdDogdHJ1ZSwgc3VidHJlZTogdHJ1ZSB9KTsKICB9CgogIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnbG9hZGluZycpIHsKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBib290c3RyYXApOwogIH0gZWxzZSB7CiAgICBib290c3RyYXAoKTsKICB9Cn0pKCk7Cg=="}]}